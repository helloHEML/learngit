package com.rongke.web.ans.utils;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.rongke.utils.ans.R;import com.rongke.web.yibao.YeepayService;import com.rongke.yibaoConfig.MerchantEnvironment;import org.apache.commons.lang.StringUtils;import java.util.HashMap;import java.util.Map;public class YiBaoUtils {    /**     * 银行卡查询     */    public static R bankCardRecord(String cardno){        Map<String,String> map = new HashMap<>();        map.put("cardno",cardno);        String url = Config.getInstance().getValue("yibao.url.bankcartselcet");//银行卡查询        JSONObject json = JSON.parseObject(JSON.toJSONString(YeepayService.yeepayYOP(map, url)));        if(json.containsKey("errorcode")){            return R.error(json.getString("errormsg"));        }        if(json.getString("isvalid").equals("INVALID")){            return R.error("银行卡无效");        }        String bankName = "借记卡";        if("CREDIT".equals(json.getString("cardtype"))){            bankName = "信用卡";        }        return R.ok().put("bankCode",json.getString("bankcode")).put("bankName",json.getString("bankname")).put("bankName1",bankName);    }    /**     * 鉴权绑卡确认     */    public static R bankCardConfirm(String code, String requestno,String cardno) {        String url = Config.getInstance().getValue("yibao.url.authBindCardConfirmUri");        String merchantNo = MerchantEnvironment.getInstance().getMerchantNo();//商户编号        Map<String, String> map = new HashMap();        map.put("merchantno", merchantNo);        map.put("requestno", requestno);        map.put("validatecode", code);        JSONObject json = JSON.parseObject(JSON.toJSONString(YeepayService.yeepayYOP(map, url)));        if(json.containsKey("errorcode")){            return R.error("绑卡失败");        }        if(!json.getString("status").equals("BIND_SUCCESS")){            return R.error("绑卡失败，请确认信息");        }        R r = R.ok();        if(StringUtils.isNotBlank(cardno)){            R rs = bankCardRecord(cardno);            if(Integer.valueOf((Integer) r.get("code"))==0){                r.put("bankName",r.get("bankName"));                r.put("bankName1",r.get("bankName1"));            }        }        r.put("bankCode",json.get("bankcode"));        return r;    }    /**     * 鉴权列表查询     *	/rest/v1.0/paperorder/auth/bindcard/list     */    public static R bankCardFind(String identityid, String identitytype){        String url = Config.getInstance().getValue("yibao.url.authListQueryUri");        Map<String, String> map = new HashMap();        map.put("identityid",identityid);//用户标识        map.put("identitytype",identitytype);//表示类型        JSONObject json = JSON.parseObject(JSON.toJSONString(YeepayService.yeepayYOP(map, url)));        if(json.containsKey("errorcode")){            return R.error(json.getString("errormsg"));        }        JSONArray cardlist = JSON.parseArray(json.getString("cardlist"));        return R.ok().put("data",cardlist.get(0));    }    public static void main(String[] args) {    }}