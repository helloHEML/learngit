package com.rongke.web.common;import org.springframework.web.client.RestTemplate;import javax.servlet.http.HttpServletRequest;/** * Created by bilibili on 2018/3/26. */public class IPConfig {    /**     * 获取客户端ip地址(可以穿透代理)     *     * @param request     * @return     */    public static String getRemoteAddr(HttpServletRequest request) {        String ip = request.getHeader("x-forwarded-for");        if(ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {            ip = request.getHeader("Proxy-Client-IP");//代理服务器        }        if(ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {            ip = request.getHeader("WL-Proxy-Client-IP");        }        if(ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {            ip = request.getRemoteAddr();        }        return ip;    }    /**     * 获取访问者IP     * 在一般情况下使用Request.getRemoteAddr()即可，但是经过nginx等反向代理软件后，这个方法会失效。     *     * 本方法先从Header中获取X-Real-IP，如果不存在再从X-Forwarded-For获得第一个IP(用,分割)，     * 如果还不存在则调用Request .getRemoteAddr()。     * @param request     * @return     */    public static String getIpAddr(HttpServletRequest request) {        String ip = request.getHeader("X-Real-IP");        if (ip!= null && !"".equals(ip) && !"unknown".equalsIgnoreCase(ip)) {            return ip;        }        ip = request.getHeader("X-Forwarded-For");        if (ip!= null && !"".equals(ip)  && !"unknown".equalsIgnoreCase(ip)) {            // 多次反向代理后会有多个IP值，第一个为真实IP。            int index = ip.indexOf(',');            if (index != -1) {                return ip.substring(0, index);            } else {                return ip;            }        } else {            return request.getRemoteAddr();        }    }    public static String ipAddrs(String key,HttpServletRequest request) {        String ipAddr = getIpAddr(request);        String url = "https://mall.ipplus360.com/ip/district/api?key=%s&ip=%s&coord=WGS84&area=multi";        RestTemplate restTemplate = new RestTemplate();        String result = restTemplate.getForObject(String.format(url,key,ipAddr), String.class);        return result;    }}