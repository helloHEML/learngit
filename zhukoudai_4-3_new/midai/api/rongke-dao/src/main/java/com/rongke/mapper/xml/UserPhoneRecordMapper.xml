<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.rongke.mapper.UserPhoneRecordMapper">    <resultMap type="com.rongke.model.UserPhoneRecord" id="rmUserPhoneRecord">        <id property="id" column="id" />        <result property="userId" column="userId"/>        <result property="taskId" column="taskId"/>        <result property="phone" column="phone"/>        <association property="user" javaType="com.rongke.model.User" >            <id property="id" column="user_id" />        </association>    </resultMap>    <resultMap type="com.rongke.model.UserPhone" id="mUserPhoneRecord">        <id property="id" column="userPhone_id" />        <result property="userId" column="userPhone_userId"/>        <result property="taskId" column="userPhone_taskId"/>        <result property="phone" column="userPhone_phone"/>        <result property="netAge" column="userPhone_netAge"/>        <result property="gmtDatetime" column="userPhone_gmtDatetime"/>        <association property="user" javaType="com.rongke.model.User" >            <id property="id" column="user_id" />            <result property="realName" column="user_realName" />            <result property="phone" column="user_phone" />        </association>    </resultMap>    <sql id="mUserPhoneRecordPkSql">        user_phone_record.id AS userPhoneRecord_id,        user_phone_record.user_id AS userPhoneRecord_userId,        user_phone_record.task_id AS userPhoneRecord_taskId,        user_phone_record.phone AS userPhoneRecord_phone,        user_phone_record.gmt_datetime AS userPhoneRecord_gmtDatetime    </sql>    <sql id="mUserPhoneRecordSql">        id AS id,        user_id AS userId,        task_id AS taskId,        phone AS phone    </sql>    <select id="selectByCondition" parameterType="UserPhoneRecord" resultMap="rmUserPhoneRecord">    select    <include refid="mUserPhoneRecordSql"></include>    from user_phone_record    <where>        <if test="id!= null">            AND id=#{id}        </if>        <if test="userId!= null">            AND user_id=#{userId}        </if>        <if test="taskId!= null">            AND task_id=#{taskId}        </if>        <if test="phone!= null">            AND phone=#{phone}        </if>    </where>    </select>    <select id="selectByPage" parameterType="java.util.Map" resultMap="mUserPhoneRecord">        select        user_phone.user_id AS userPhone_userId,        user_phone.phone AS userPhone_phone,        user_phone.gmt_datetime AS userPhone_gmtDatetime,        user_phone.net_age AS userPhone_netAge,        `user`.real_name AS user_realName,        `user`.phone AS user_phone        from user_phone,`user`        WHERE user_phone.user_id=`user`.id        <if test="phone!= null and phone!= ''">            AND  `user`.`phone` LIKE CONCAT(CONCAT('%',#{phone}),'%')        </if>        ORDER BY user_phone.gmt_datetime DESC        LIMIT ${pageNo},${pageSize}    </select>    <select id="selectCount" parameterType="java.util.Map" resultType="java.lang.Integer">        select        COUNT(1)        from user_phone,`user`        WHERE user_phone.user_id=`user`.id        <if test="phone!= null and phone!= ''">            AND  `user`.`phone` LIKE CONCAT(CONCAT('%',#{phone}),'%')        </if>    </select>    <select id="selectConnTimeTop" parameterType="java.lang.Long" resultType="string">        SELECT phone phone,SUM(conn_times) payTime        FROM `user_phone_record`        WHERE user_phone_record.user_id = #{userId}        GROUP BY phone        ORDER BY payTime DESC    </select>    <resultMap type="com.rongke.model.UserPhoneRecord" id="selectByUserIdRMap">        <id property="id" column="id" />        <result property="listUserId" column="pListUserId"/>        <result property="pUserId" column="pUserId"/>        <result property="userName" column="userName"/>        <result property="link" column="link"/>        <result property="callType" column="callType"/>        <result property="connTimes" column="connTimes"/>        <result property="callTimes" column="callTimes"/>    </resultMap>    <select id="selectByUserId" parameterType="java.util.Map" resultMap="selectByUserIdRMap">        SELECT a.*,SUM(conn_times) connTimes,SUM(1) callTimes FROM (SELECT record.id,record.phone phone,p_list.name userName,p_list.`relation` link ,p_list.`id` pUserId,record.call_type callType,record.conn_times,p_list.`user_id` pListUserId        FROM `user_phone_record` record LEFT JOIN `user_contact` p_list ON record.`phone`=p_list.`phone`        WHERE record.user_id=#{userId} AND record.call_type=#{callType} AND (p_list.`user_id`=#{userId} OR p_list.`user_id` IS NULL)) a        GROUP BY phone    </select>    <insert id="saveCall" parameterType="java.util.List">        insert into user_phone_record (user_id,conn_times,comm_fee,call_type,phone) values        <foreach collection ="list" item="b" index= "index" separator =",">            (            #{b.userId},            #{b.connTimes},            #{b.commFee},            #{b.callType},            #{b.phone}            )        </foreach>    </insert></mapper>